<template>
	<view class="search-sort-wrap">
    <view class="sort-item {{ !isSaleFirst? 'activated': '' }}">
      <view @tap="showSort">
        <text>{{sortType[0].name}}</text>
        <i class="arrow"></i>        
      </view>

      <view animation="{{animationData}}" class="sort-items">
        <view @tap="changeSort(1)">{{sortType[1].name}}</view>
        <view @tap="changeSort(2)">{{sortType[2].name}}</view>
      </view>

    </view>
    <view @tap="saleFirst" class="sort-item {{ isSaleFirst? 'activated': '' }}">
      <text>销量优先</text>
    </view>
	</view>
</template>

<script>
import wepy from 'wepy'
export default class SearchDetailSort extends wepy.component {
  data = {
    animationData: {},
    show: true,
    sortType: [
      {type: 'comprehensive', name: '综合排序'},
      {type: 'price_asc', name:'价格升序'},
      {type: 'price_desc', name: '价格降序'},
    ],
    cname: '',

    isSaleFirst: false
  }

  methods = {
    showSort () {
      if (this.show) {
        this.animation.height('160rpx').step()
        this.animationData = this.animation.export()
        this.show = false
      } else {
        this.animation.height('0').step()
        this.animationData = this.animation.export()
        this.show = true
      }
      this.$apply()
    },
    
    changeSort (i) {
      this.isSaleFirst = false
      let temp = this.sortType[i]
      this.sortType[i] = this.sortType[0]
      this.sortType[0] = temp
      this.animation.height('0').step()
      this.animationData = this.animation.export()
      this.show = true
      this.$apply()
    },

    saleFirst () {
      this.isSaleFirst = true
      this.$invoke('../searchDetail-item', 'changeSort', 'sale_first')

      this.$apply()
    }
  }

  events = {
    changeName (name) {
      this.cname = name
    }
  }

  watch = {
    sortType (newValue, oldValue) {
      this.$invoke('../searchDetail-item', 'changeSort', newValue[0].type)
    }
  }

  onLoad () {
    var animation = wx.createAnimation({
      duration: 100,
  	  timingFunction: 'ease',
    })
    this.animation = animation
  }
}
</script>

<style lang="stylus" scoped>
  .search-sort-wrap
    background #ffffff
    display flex
    border-bottom 2rpx solid #ccc

    .sort-item
      color #999
      text-align center
      height 80rpx
      line-height 80rpx
      flex 1
      box-sizing border-box
      border-left 2rpx solid #eee
      position relative

      text
        font-size 28rpx

      .arrow
        position: relative;
        top: -3px;
        display: inline-block;
        margin-left: 4px;
        width: 6px;
        height: 3px;
        background-size: 6px 3px;
        background-repeat: no-repeat;
        background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAGCAMAAADAMI+zAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAQlBMVEX/////UAD/UAD/UAD/UAD/UAD/UAD/UAD/UAD/UAD/UAD/UAD/UAD/UAD/UAD/UAD/UAD/UAD/UAD/UAD/UAD///9It+BMAAAAFHRSTlMA5+OrpwOTjmz8+2hJ8vBGLdbSK35PS8AAAAABYktHRACIBR1IAAAAMklEQVQI12NgFIEDJgZmBIeFgZUNxmZnZWBg4OAEMbm4GcCAh1dEhI+fAQoEBIWEQTQAoJUDbNS7QAEAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTUtMDEtMjZUMTY6MTE6MzcrMDg6MDD8hUqjAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE1LTAxLTI2VDE2OjExOjM3KzA4OjAwjdjyHwAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAASUVORK5CYII=")  

      .sort-items
        color #666
        position absolute
        top 80rpx
        left 0
        background #ffffff
        overflow hidden
        font-size 28rpx
        display flex
        justify-content center
        align-items center
        flex-direction column
        z-index 100
        width 100%
        opacity 0.9
        height 0

    .activated
      color #f50
</style>
